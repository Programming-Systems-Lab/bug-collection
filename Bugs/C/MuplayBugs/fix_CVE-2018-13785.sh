# The buggy version will be terminated by core dump
git clone https://github.com/glennrp/libpng.git libpng-buggy
cd libpng-buggy/
git checkout cde1e1fe79974a37d7ef255a44dae3bfd1b34a0f
sed -i 's/return ((int)(crc != png_ptr->crc));/return (0);/g' pngrutil.c
autoreconf -f -i
./configure --disable-shared
make clean all check
wget https://sourceforge.net/p/libpng/bugs/278/attachment/crash1.png
./pngimage crash1.png &> ../result_buggy.txt
cd ..

git clone https://github.com/glennrp/libpng.git libpng-fixed
cd libpng-fixed/
git checkout 8a05766cb74af05c04c53e6c9d60c13fc4d59bf2
sed -i 's/return ((int)(crc != png_ptr->crc));/return (0);/g' pngrutil.c
autoreconf -f -i
./configure --disable-shared
make clean all check
wget https://sourceforge.net/p/libpng/bugs/278/attachment/crash1.png
./pngimage crash1.png &> ../result_fixed.txt
